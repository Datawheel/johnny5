

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>johnny5.classes &mdash; johnny5 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="johnny5 1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> johnny5
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">johnny5</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>johnny5.classes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for johnny5.classes</h1><div class="highlight"><pre>
<span></span><span class="k">try</span><span class="p">:</span>
	<span class="n">xrange</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
	<span class="n">xrange</span> <span class="o">=</span> <span class="nb">range</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">future</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">pass</span>
<span class="kn">import</span> <span class="nn">json</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">operator</span><span class="o">,</span><span class="nn">copy</span><span class="o">,</span><span class="nn">mwparserfromhell</span><span class="o">,</span><span class="nn">datetime</span><span class="o">,</span><span class="nn">codecs</span><span class="o">,</span><span class="nn">re</span>
<span class="kn">import</span> <span class="nn">nltk.data</span><span class="o">,</span><span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="k">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span><span class="p">,</span><span class="n">read_csv</span>
<span class="kn">from</span> <span class="nn">.functions</span> <span class="k">import</span> <span class="n">country</span><span class="p">,</span><span class="n">_dms2dd</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="k">import</span> <span class="n">vincenty</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">spotipy</span>
<span class="k">except</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: spotipy module not found&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">cpu_count</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="k">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">.query</span> <span class="k">import</span> <span class="n">wd_q</span><span class="p">,</span><span class="n">wp_q</span><span class="p">,</span><span class="n">_string</span><span class="p">,</span><span class="n">_isnum</span><span class="p">,</span><span class="n">_rget</span>
<span class="kn">from</span> <span class="nn">.parse_functions</span> <span class="k">import</span> <span class="n">drop_comments</span><span class="p">,</span><span class="n">find_nth</span><span class="p">,</span><span class="n">parse_date</span><span class="p">,</span><span class="n">get_links</span><span class="p">,</span><span class="n">correct_titles</span><span class="p">,</span><span class="n">parse_ints</span><span class="p">,</span><span class="n">parse_p</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">mean</span>
<span class="kn">import</span> <span class="nn">six</span>


<div class="viewcode-block" id="article"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article">[docs]</a><span class="k">class</span> <span class="nc">article</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This is the main class for this module.</span>
<span class="sd">	All other classes belong to this class.</span>
<span class="sd">	The class can be initialized by a en_curid, a title, or a wikidata_id.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	I : str or int</span>
<span class="sd">		Either the english curid, the wikidata id, or the title for the english Wikipedia.</span>
<span class="sd">	Itype : str (optional)</span>
<span class="sd">		Either &#39;title&#39;, &#39;curid&#39;, or &#39;wdid&#39;</span>
<span class="sd">		Type of I.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">slow_connection</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="n">Itype</span> <span class="o">=</span> <span class="n">_id_type</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="k">if</span> <span class="n">Itype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Itype</span>
		<span class="k">if</span> <span class="n">Itype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;curid&#39;</span><span class="p">,</span><span class="s1">&#39;wdid&#39;</span><span class="p">]:</span>
			<span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s2">&quot;Unrecognized Itype, please choose between title, curid, or wdid&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;curid&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;wdid&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="n">Itype</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wp&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;wd&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_curid_nonen</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_slow_connection</span> <span class="o">=</span> <span class="n">slow_connection</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_ex</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span> <span class="o">=</span> <span class="kc">None</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_infobox</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">raw_box</span>  <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims</span>      <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims_data</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_feats</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_occ</span>   <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_revisions</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_views</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_previous_titles</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_isa_values</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slow_connection</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">find_article</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;curid : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;curid : </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;title : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;title : </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;wdid  : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;wdid  : &#39;</span>
		<span class="k">return</span> <span class="n">out</span><span class="c1">#.encode(&#39;utf-8&#39;)</span>

	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">wdid</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;curid : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;title : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;curid : None</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;title : None</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;wdid  : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">wdid</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;wdid  : None</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;L     : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">())</span> 
		<span class="k">return</span> <span class="n">out</span><span class="c1">#.encode(&#39;utf-8&#39;)</span>

	<span class="k">def</span> <span class="nf">_missing_wd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		This function is used to signal that the article does not correspond to a Wikidata page.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="k">def</span> <span class="nf">_missing_wp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		This function is used to signal that the article does not correspond to a Wikipedia page.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="article.data_wp"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.data_wp">[docs]</a>	<span class="k">def</span> <span class="nf">data_wp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the metadata about the Wikipedia page.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">):</span>
			<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;pageprops&#39;</span><span class="p">,</span><span class="s1">&#39;ppprop&#39;</span><span class="p">:</span><span class="s1">&#39;wikibase_item&#39;</span><span class="p">,</span><span class="s1">&#39;pageids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]})[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;pageprops&#39;</span><span class="p">,</span><span class="s1">&#39;ppprop&#39;</span><span class="p">:</span><span class="s1">&#39;wikibase_item&#39;</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]})[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">wd_q</span><span class="p">({</span><span class="s1">&#39;languages&#39;</span><span class="p">:</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]})</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;info&#39;</span><span class="p">])</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wd</span><span class="p">()</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
				<span class="k">if</span> <span class="s1">&#39;sitelinks&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="n">sitelinks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">][</span><span class="s1">&#39;sitelinks&#39;</span><span class="p">]</span>
					<span class="k">if</span> <span class="s1">&#39;enwiki&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sitelinks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitelinks</span><span class="p">[</span><span class="s1">&#39;enwiki&#39;</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
					<span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wp</span><span class="p">()</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wp</span><span class="p">()</span>
				<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;pageprops&#39;</span><span class="p">,</span><span class="s1">&#39;ppprop&#39;</span><span class="p">:</span><span class="s1">&#39;wikibase_item&#39;</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]})[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No identifier found.&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">:</span>
				<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;missing&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">|</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wp</span><span class="p">()</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.data_wd"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.data_wd">[docs]</a>	<span class="k">def</span> <span class="nf">data_wd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the metadata about the Wikidata page.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">):</span>
			<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
				<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()</span>
				<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wp&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="s1">&#39;wikibase_item&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;pageprops&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pageprops&#39;</span><span class="p">][</span><span class="s1">u&#39;wikibase_item&#39;</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wd</span><span class="p">()</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wd_q</span><span class="p">({</span><span class="s1">&#39;languages&#39;</span><span class="p">:</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]})[</span><span class="s1">&#39;entities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;wd&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.wdid"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.wdid">[docs]</a>	<span class="k">def</span> <span class="nf">wdid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the wdid of the article.</span>
<span class="sd">		Will get it if it is not provided.</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">):</span>
			<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()</span>
			<span class="k">if</span> <span class="s1">&#39;pageprops&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
				<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()[</span><span class="s1">&#39;pageprops&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="s1">&#39;wikibase_item&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;wikibase_item&#39;</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wd</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wd</span><span class="p">()</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;wdid&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.curid"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.curid">[docs]</a>	<span class="k">def</span> <span class="nf">curid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the english curid of the article.</span>
<span class="sd">		Will get it if it is not provided.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()[</span><span class="s1">&#39;pageid&#39;</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.title"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.title">[docs]</a>	<span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the title of the article.</span>
<span class="sd">		Will get it if it is not provided.</span>

<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.url"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.url">[docs]</a>	<span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wiki</span><span class="o">=</span><span class="s1">&#39;wp&#39;</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">wiki</span> <span class="o">==</span> <span class="s1">&#39;wp&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Wikipedia page corresponding to this article&quot;</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="o">+</span><span class="n">lang</span><span class="o">+</span><span class="s1">&#39;.wikipedia.org/wiki/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No article in this edition&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">wiki</span> <span class="o">==</span><span class="s1">&#39;wd&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Wikidata page corresponding to this article&quot;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;https://www.wikidata.org/wiki/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">wdid</span><span class="p">())</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Wrong wiki&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="article.curid_nonen"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.curid_nonen">[docs]</a>	<span class="k">def</span> <span class="nf">curid_nonen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the curid in a non-english language.</span>
<span class="sd">		The curid is a string and has the form: &#39;lang.curid&#39;</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curid_nonen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">lang</span><span class="p">,</span><span class="n">title</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;pageprops&#39;</span><span class="p">,</span><span class="s1">&#39;ppprop&#39;</span><span class="p">:</span><span class="s1">&#39;wikibase_item&#39;</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="n">title</span><span class="p">},</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_curid_nonen</span> <span class="o">=</span> <span class="n">lang</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;pageid&#39;</span><span class="p">])</span>
					<span class="k">break</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curid_nonen</span></div>

<div class="viewcode-block" id="article.wiki_links"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.wiki_links">[docs]</a>	<span class="k">def</span> <span class="nf">wiki_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">section_title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all the Wikipedia pages linked from the article.</span>
<span class="sd">		It only returns Wikipedia pages.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		titles : set</span>
<span class="sd">			Set of titles for the Wikipedia pages linked from the article.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;##&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">section_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">links</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">())</span><span class="o">.</span><span class="n">filter_wikilinks</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">links</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">section_title</span><span class="p">))</span><span class="o">.</span><span class="n">filter_wikilinks</span><span class="p">()</span>
		<span class="n">titles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">link</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">])</span>
		<span class="n">titles</span> <span class="o">=</span> <span class="n">titles</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">remove</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">titles</span></div>

<div class="viewcode-block" id="article.infobox"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.infobox">[docs]</a>	<span class="k">def</span> <span class="nf">infobox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the infobox of the article.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		lang : str (default=&#39;en&#39;)</span>
<span class="sd">			Language edition to get the infobox from.</span>
<span class="sd">		force : boolean (False)</span>
<span class="sd">			If True it will &#39;force&#39; the search for the infobox by getting the template that is the most similar to an Infobox.</span>
<span class="sd">			Recommended usage is only for non english editions.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infobox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">rbox</span> <span class="o">=</span> <span class="s1">&#39;#redirect&#39;</span>
				<span class="k">while</span> <span class="s1">&#39;#redirect&#39;</span> <span class="ow">in</span> <span class="n">rbox</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s2">&quot;revisions&quot;</span><span class="p">,</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;rvsection&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pageids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()})</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">rbox</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="n">rbox</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
					<span class="k">if</span> <span class="s1">&#39;#redirect&#39;</span> <span class="ow">in</span> <span class="n">rbox</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">title</span> <span class="o">=</span> <span class="n">rbox</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;]]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">raw_box</span> <span class="o">=</span> <span class="n">rbox</span>
			<span class="n">wikicode</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_box</span><span class="p">)</span>
			<span class="n">templates</span> <span class="o">=</span> <span class="n">wikicode</span><span class="o">.</span><span class="n">filter_templates</span><span class="p">()</span>
			<span class="n">box</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">box_pos</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
				<span class="n">name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
				<span class="k">if</span> <span class="s1">&#39;infobox&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
					<span class="n">box_</span> <span class="o">=</span> <span class="p">{}</span>
					<span class="n">box_type</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;infobox&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
						<span class="n">key</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">_string</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip_code</span><span class="p">()))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
						<span class="n">value</span> <span class="o">=</span> <span class="n">_string</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

						<span class="n">box_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
					<span class="n">box_</span><span class="p">[</span><span class="s1">&#39;box_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_pos</span>
					<span class="n">box_pos</span><span class="o">+=</span><span class="mi">1</span>
					<span class="n">box</span><span class="p">[</span><span class="n">box_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_</span>					
			<span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_infobox</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_infobox</span> <span class="o">=</span> <span class="n">box</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infobox</span> <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infobox_nonen</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_infobox_nonen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Gets the infobox for non english wikipedias.&#39;&#39;&#39;</span>
		<span class="n">ibox_codebook</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;infobox&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;es&#39;</span><span class="p">:</span><span class="s1">&#39;ficha de&#39;</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">:</span><span class="s1">&#39;infotaula de&#39;</span><span class="p">,</span><span class="s1">&#39;sv&#39;</span><span class="p">:</span><span class="s1">&#39;infobox&#39;</span><span class="p">,</span>
														<span class="s1">&#39;nl&#39;</span><span class="p">:</span><span class="s1">&#39;infobox&#39;</span><span class="p">,</span><span class="s1">&#39;fr&#39;</span><span class="p">:</span><span class="s1">&#39;infobox&#39;</span><span class="p">,</span><span class="s1">&#39;pl&#39;</span><span class="p">:</span><span class="s1">&#39;infobox&#39;</span><span class="p">,</span><span class="s1">&#39;pt&#39;</span><span class="p">:</span><span class="s1">&#39;info&#39;</span><span class="p">,</span>
														<span class="s1">&#39;ru&#39;</span><span class="p">:</span><span class="s1">u&#39;</span><span class="se">\u0433\u043e\u0441\u0443\u0434\u0430\u0440\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439</span><span class="s1">&#39;</span>
														<span class="p">})</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">return</span> <span class="p">{}</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s2">&quot;revisions&quot;</span><span class="p">,</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;rvsection&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">lang</span><span class="p">)},</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">rbox</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">rbox</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">ibox_name</span> <span class="o">=</span> <span class="n">ibox_codebook</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span>
		<span class="n">wikicode</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">rbox</span><span class="p">)</span>
		<span class="n">templates</span> <span class="o">=</span> <span class="n">wikicode</span><span class="o">.</span><span class="n">filter_templates</span><span class="p">()</span>
		<span class="n">box</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">box_pos</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">ibox_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
				<span class="n">box_</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="n">box_type</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ibox_name</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
					<span class="n">key</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">_string</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip_code</span><span class="p">()))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">_string</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="n">box_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
				<span class="n">box_</span><span class="p">[</span><span class="s1">&#39;box_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_pos</span>
				<span class="n">box_pos</span><span class="o">+=</span><span class="mi">1</span>
				<span class="n">box</span><span class="p">[</span><span class="n">box_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_</span>
				
		<span class="k">if</span> <span class="p">(</span><span class="n">box</span> <span class="o">==</span> <span class="p">{})</span> <span class="o">&amp;</span> <span class="n">force</span><span class="p">:</span>
			<span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="c1">#Infobox should have at least 7 fields</span>
			<span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
				<span class="n">name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">length</span><span class="p">:</span>
					<span class="n">box_</span> <span class="o">=</span> <span class="p">{}</span>
					<span class="n">box_type</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">_string</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
						<span class="n">key</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">_string</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip_code</span><span class="p">()))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
						<span class="n">value</span> <span class="o">=</span> <span class="n">_string</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="n">box_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
					<span class="n">box_</span><span class="p">[</span><span class="s1">&#39;box_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_pos</span>
					<span class="n">box_pos</span><span class="o">+=</span><span class="mi">1</span>
					<span class="n">box</span><span class="p">[</span><span class="n">box_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_</span>
					
		<span class="k">return</span> <span class="n">box</span>

<div class="viewcode-block" id="article.extract"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.extract">[docs]</a>	<span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the page extract (brief description).</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		lang : str (default=&#39;en&#39;)</span>
<span class="sd">			Language edition to get the infobox from.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		extract : str</span>
<span class="sd">			Wikipedia page extract.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">lang</span><span class="o">==</span><span class="s1">&#39;en&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;extracts&#39;</span><span class="p">,</span><span class="s1">&#39;exintro&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;explaintext&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;pageids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()})</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_ex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;extract&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Functionality not supported yet&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ex</span></div>

<div class="viewcode-block" id="article.langlinks"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.langlinks">[docs]</a>	<span class="k">def</span> <span class="nf">langlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the langlinks of the article.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		lang : str (optional)</span>
<span class="sd">			Language to get the link for.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		out : str or dict</span>
<span class="sd">			If a language is provided, it will return the name of the page in that language.</span>
<span class="sd">			If no language is provided, it will resturn a dictionary with the languages as keys and the titles as values.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">Itype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;curid&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;wdid&#39;</span><span class="p">]:</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="n">Itype</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">Itype</span> <span class="o">==</span> <span class="s1">&#39;wdid&#39;</span><span class="p">:</span>
							<span class="k">if</span> <span class="s1">&#39;sitelinks&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_wd</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
								<span class="n">sitelinks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wd</span><span class="p">()[</span><span class="s1">u&#39;sitelinks&#39;</span><span class="p">]</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span> <span class="o">=</span> <span class="p">[]</span>
								<span class="k">for</span> <span class="n">lan</span> <span class="ow">in</span> <span class="n">sitelinks</span><span class="p">:</span>
									<span class="n">lan</span> <span class="o">=</span> <span class="n">lan</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
									<span class="k">if</span> <span class="p">(</span><span class="n">lan</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;wiki&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lan</span><span class="o">!=</span><span class="s1">&#39;commonswiki&#39;</span><span class="p">):</span>
										<span class="n">val</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span><span class="n">lan</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;*&#39;</span><span class="p">:</span><span class="n">sitelinks</span><span class="p">[</span><span class="n">lan</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]}</span>
										<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span> <span class="o">=</span> <span class="p">[]</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">Itype</span> <span class="o">==</span> <span class="s1">&#39;curid&#39;</span><span class="p">:</span>
								<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;langlinks&#39;</span><span class="p">,</span><span class="s1">&#39;lllimit&#39;</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="s1">&#39;pageids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="n">Itype</span><span class="p">]})</span>
							<span class="k">elif</span> <span class="n">Itype</span> <span class="o">==</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span>
								<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;langlinks&#39;</span><span class="p">,</span><span class="s1">&#39;lllimit&#39;</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="n">Itype</span><span class="p">]})</span>
							<span class="k">if</span> <span class="s1">&#39;langlinks&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;langlinks&#39;</span><span class="p">]</span>  
							<span class="k">else</span><span class="p">:</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span> <span class="o">=</span> <span class="p">[]</span>
						<span class="k">break</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]:</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_langlinks_dat</span><span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;en&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span><span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span> <span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_langlinks</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.creation_date"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.creation_date">[docs]</a>	<span class="k">def</span> <span class="nf">creation_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the creation date of the different Wikipedia language editions.</span>
<span class="sd">		The Wikipedia API requires this data to be requestes one page at a time, so there is no boost in collecting pages into a list.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		lang : str (optional)</span>
<span class="sd">			Language to get the creation date for.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		timestamp : str or dict</span>
<span class="sd">			Timestamp in the format &#39;2002-07-26T04:32:17Z&#39;.</span>
<span class="sd">			If lang is not provided it will return a dictionary with languages as keys and timestamps as values.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;revisions&#39;</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="n">title</span><span class="p">,</span><span class="s1">&#39;rvlimit&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;rvdir&#39;</span><span class="p">:</span><span class="s1">&#39;newer&#39;</span><span class="p">},</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">continue_override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="n">timestamp</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No edition for language: &#39;</span><span class="o">+</span><span class="n">lang</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
				<span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
				<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;revisions&#39;</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="n">title</span><span class="p">,</span><span class="s1">&#39;rvlimit&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;rvdir&#39;</span><span class="p">:</span><span class="s1">&#39;newer&#39;</span><span class="p">},</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">continue_override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">timestamp</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.L"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.L">[docs]</a>	<span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the number of language editions of the article.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">())</span></div>

<div class="viewcode-block" id="article.previous_titles"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.previous_titles">[docs]</a>	<span class="k">def</span> <span class="nf">previous_titles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets all the previous titles the page had</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_titles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;revisions&#39;</span><span class="p">,</span><span class="s1">&#39;pageids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">(),</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="s1">&#39;comment&#39;</span><span class="p">],</span><span class="s1">&#39;rvlimit&#39;</span><span class="p">:</span><span class="s1">&#39;500&#39;</span><span class="p">})</span>
			<span class="n">titles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
			<span class="k">for</span> <span class="n">rev</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">]:</span>
				<span class="k">if</span> <span class="s1">&#39;comment&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rev</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="k">if</span> <span class="s1">&#39;moved page&#39;</span> <span class="ow">in</span> <span class="n">rev</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]:</span>
						<span class="n">comment</span> <span class="o">=</span> <span class="n">rev</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span>
						<span class="n">titles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comment</span><span class="p">[</span><span class="n">comment</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;]]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_previous_titles</span> <span class="o">=</span> <span class="n">titles</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_titles</span></div>

<div class="viewcode-block" id="article.image_url"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.image_url">[docs]</a>	<span class="k">def</span> <span class="nf">image_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the url for the image that appears in the infobox.</span>
<span class="sd">		It iterates over a list of languages, ordered according to their wikipedia size, until it finds one.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data_wp</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="s1">&#39;sv&#39;</span><span class="p">,</span><span class="s1">&#39;ceb&#39;</span><span class="p">,</span><span class="s1">&#39;de&#39;</span><span class="p">,</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span><span class="s1">&#39;fr&#39;</span><span class="p">,</span><span class="s1">&#39;ru&#39;</span><span class="p">,</span><span class="s1">&#39;it&#39;</span><span class="p">,</span><span class="s1">&#39;es&#39;</span><span class="p">,</span><span class="s1">&#39;war&#39;</span><span class="p">,</span><span class="s1">&#39;pl&#39;</span><span class="p">,</span><span class="s1">&#39;vi&#39;</span><span class="p">,</span><span class="s1">&#39;ja&#39;</span><span class="p">,</span><span class="s1">&#39;pt&#39;</span><span class="p">,</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="s1">&#39;uk&#39;</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">,</span><span class="s1">&#39;fa&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="s1">&#39;ar&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;fi&#39;</span><span class="p">]:</span>
					<span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_url_lang</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
						<span class="k">break</span>
			<span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">images</span> <span class="o">=</span> <span class="s1">&#39;File:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P18&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="n">images</span><span class="p">,</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;imageinfo&#39;</span><span class="p">,</span><span class="s1">&#39;iiprop&#39;</span><span class="p">:</span><span class="s1">&#39;url&#39;</span><span class="p">,</span><span class="s1">&#39;iilimit&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">continue_override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;imageinfo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_url</span></div>

	<span class="k">def</span> <span class="nf">_image_url_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="p">):</span>
		<span class="n">tags_codebook</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
						<span class="k">lambda</span><span class="p">:[</span><span class="s1">&#39;image&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">,</span><span class="s1">&#39;image_name&#39;</span><span class="p">],</span>
							<span class="p">{</span><span class="s1">&#39;en&#39;</span><span class="p">:[</span><span class="s1">&#39;image&#39;</span><span class="p">,</span><span class="s1">&#39;image_name&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">,</span><span class="s1">&#39;smallimage&#39;</span><span class="p">],</span><span class="s1">&#39;es&#39;</span><span class="p">:[</span><span class="s1">&#39;imagen&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">],</span>
							<span class="s1">&#39;pt&#39;</span><span class="p">:[</span><span class="s1">&#39;imagem&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">],</span><span class="s1">&#39;nl&#39;</span><span class="p">:[</span><span class="s1">&#39;afbeelding&#39;</span><span class="p">],</span><span class="s1">&#39;fr&#39;</span><span class="p">:[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span><span class="s1">&#39;ja&#39;</span><span class="p">:[</span><span class="s1">u&#39;</span><span class="se">\u753b\u50cf</span><span class="s1">&#39;</span><span class="p">],</span>
							<span class="s1">&#39;ru&#39;</span><span class="p">:[</span><span class="s1">u&#39;</span><span class="se">\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435</span><span class="s1">&#39;</span><span class="p">],</span>
							<span class="s1">&#39;uk&#39;</span><span class="p">:[</span><span class="s1">u&#39;</span><span class="se">\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f</span><span class="s1">&#39;</span><span class="p">],</span>
							<span class="s1">&#39;pl&#39;</span><span class="p">:[</span><span class="s1">u&#39;zdj</span><span class="se">\u0119</span><span class="s1">cie&#39;</span><span class="p">],</span><span class="s1">&#39;sv&#39;</span><span class="p">:[</span><span class="s1">&#39;bild&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">]</span>
							<span class="p">})</span>
		<span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">tags</span> <span class="o">=</span> <span class="n">tags_codebook</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span>
		<span class="n">ibox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">btype</span> <span class="ow">in</span> <span class="n">ibox</span><span class="p">:</span>
			<span class="n">box</span> <span class="o">=</span> <span class="n">ibox</span><span class="p">[</span><span class="n">btype</span><span class="p">]</span>
			<span class="n">box_pos</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s1">&#39;box_pos&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">box_pos</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">btype</span> <span class="ow">in</span> <span class="n">ibox</span><span class="p">:</span>
			<span class="n">box</span> <span class="o">=</span> <span class="n">ibox</span><span class="p">[</span><span class="n">btype</span><span class="p">]</span>
			<span class="n">box_pos</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s1">&#39;box_pos&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">box_pos</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
		<span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;[[&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
					<span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;]]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">image</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;file:&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;image:&#39;</span><span class="p">)):</span>
					<span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Image:&#39;</span><span class="o">+</span><span class="n">image</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
		<span class="n">images</span> <span class="o">=</span> <span class="n">imgs</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="n">images</span><span class="p">,</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;imageinfo&#39;</span><span class="p">,</span><span class="s1">&#39;iiprop&#39;</span><span class="p">:</span><span class="s1">&#39;url&#39;</span><span class="p">,</span><span class="s1">&#39;iilimit&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">continue_override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">norm</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="k">if</span> <span class="s1">&#39;normalized&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="c1">#This is to keep the order</span>
					<span class="n">norm</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]:</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;normalized&#39;</span><span class="p">]}</span>
				<span class="n">pages</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">pages</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;imageinfo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="k">pass</span>
				<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">image</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="n">image</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="n">image</span><span class="p">]</span>
					<span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pages</span><span class="p">[</span><span class="n">image</span><span class="p">])</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">return</span> <span class="n">results</span>

<div class="viewcode-block" id="article.wd_prop"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.wd_prop">[docs]</a>	<span class="k">def</span> <span class="nf">wd_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prop</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the requested Wikidata propery.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		prop : str</span>
<span class="sd">			Wikidata code for the property.</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		props : list</span>
<span class="sd">			List of values for the given property.</span>

<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		To get the date of birth of Albert Einstein run:</span>
<span class="sd">		&gt;&gt;&gt; b = johnny5.article(&#39;Q937&#39;)</span>
<span class="sd">		&gt;&gt;&gt; b.wd_prop(&#39;P569&#39;)</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wd</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">prop</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;claims&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="n">vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;claims&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">]</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
						<span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;mainsnak&#39;</span><span class="p">][</span><span class="s1">&#39;datavalue&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
							<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">val</span><span class="p">}))</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">)]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">)]</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wd_claims</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.dump"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.dump">[docs]</a>	<span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Dumps the object to a file.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span>
		<span class="n">file_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span> <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">path</span> <span class="o">+</span>  <span class="n">file_name</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
			<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="article.content"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.content">[docs]</a>	<span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the content of the Wikipedia page in the selected language.</span>
<span class="sd">		The output is in Wikipedia markup.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		lang : str (default=&#39;en&#39;)</span>
<span class="sd">			Language</span>

<span class="sd">		Returns </span>
<span class="sd">		-------</span>
<span class="sd">		content : str</span>
<span class="sd">			Content for the page in the given language.</span>
<span class="sd">			Content is in WikiMarkup</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">lang</span><span class="o">==</span><span class="s1">&#39;en&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">):</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;revisions&#39;</span><span class="p">,</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">})</span>
					<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;interwiki&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wp</span><span class="p">()</span>
						<span class="k">return</span> <span class="s1">&#39;#REDIRECT [[&#39;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;interwiki&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;]]&#39;</span>
					<span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;missing&#39;</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">|</span><span class="p">(</span><span class="s1">&#39;invalidreason&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_missing_wp</span><span class="p">()</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> 
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Functionality not supported yet.&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span></div>

<div class="viewcode-block" id="article.section"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.section">[docs]</a>	<span class="k">def</span> <span class="nf">section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">section_title</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the content inside the given section of the English Wikipedia page.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		section_title : str</span>
<span class="sd">			Title of the section.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		content : str</span>
<span class="sd">			Content of the section in WikiMarkup</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">title</span> <span class="o">=</span> <span class="n">section_title</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">insec</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">insec</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">==</span><span class="n">depth</span><span class="p">:</span>
					<span class="k">break</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
				<span class="n">insec</span><span class="o">=</span><span class="kc">True</span>
				<span class="n">depth</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
				<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>

<div class="viewcode-block" id="article.redirect"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.redirect">[docs]</a>	<span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Handles redirects if the page has one.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="s1">&#39;#redirect&#39;</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
				<span class="n">red</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">content</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#redirect&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;]]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="s1">&#39;|&#39;</span> <span class="ow">in</span> <span class="n">red</span><span class="p">:</span>
					<span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">red</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">red</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="article.revisions"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.revisions">[docs]</a>	<span class="k">def</span> <span class="nf">revisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the timestamps for the edit history of the Wikipedia article.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		user : boolean (True)</span>
<span class="sd">			If True it returns the user who made the edit as well as the edit timestamp.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_revisions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;revisions&#39;</span><span class="p">,</span><span class="s1">&#39;pageids&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">(),</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span><span class="s1">&#39;user&#39;</span><span class="p">],</span><span class="s1">&#39;rvlimit&#39;</span><span class="p">:</span><span class="s1">&#39;500&#39;</span><span class="p">})</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_revisions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">rev</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span><span class="n">rev</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">rev</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">user</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_revisions</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_revisions</span><span class="p">]</span></div>

<div class="viewcode-block" id="article.pageviews"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.pageviews">[docs]</a>	<span class="k">def</span> <span class="nf">pageviews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">agg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="n">cdate_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the pageviews between the provided dates for the given language editions.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		start_date : str</span>
<span class="sd">			Start date in format &#39;yyyy-mm&#39;.</span>
<span class="sd">			If start_date=None is passed, it will get all the pageviews for that edition.</span>
<span class="sd">		end_date : str</span>
<span class="sd">			End date in format &#39;yyyy-mm&#39;. If it is not provided it will get pagviews until today.</span>
<span class="sd">		lang : str (&#39;en&#39;)</span>
<span class="sd">			Language edition to get the pageviews for. </span>
<span class="sd">			If lang=None is passed, it will get the pageviews for all language editions.</span>
<span class="sd">		daily : boolean (False)</span>
<span class="sd">			If True it will return the daily pageviews.</span>
<span class="sd">		agg : boolean (False)</span>
<span class="sd">			If True it will sum all the pageviews.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="k">if</span> <span class="n">agg</span><span class="p">:</span>
					<span class="n">out</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pageviews_lang</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">cdate_override</span><span class="o">=</span><span class="n">cdate_override</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="n">daily</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">out</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pageviews_lang</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">cdate_override</span><span class="o">=</span><span class="n">cdate_override</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="n">daily</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">out</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">agg</span><span class="p">:</span>
				<span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pageviews_lang</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">cdate_override</span><span class="o">=</span><span class="n">cdate_override</span><span class="p">)</span>
				<span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pageviews_lang</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">cdate_override</span><span class="o">=</span><span class="n">cdate_override</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="n">daily</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">out</span></div>

	<span class="k">def</span> <span class="nf">_pageviews_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="n">cdate_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">y0</span><span class="p">,</span><span class="n">m0</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			<span class="n">m0</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m0</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">m0</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>

		<span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">yf</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
			<span class="n">mf</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span>
			<span class="k">if</span> <span class="n">mf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">yf</span> <span class="o">=</span> <span class="n">yf</span><span class="o">-</span><span class="mi">1</span>
				<span class="n">mf</span> <span class="o">=</span> <span class="mi">12</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">mf</span> <span class="o">=</span> <span class="n">mf</span><span class="o">-</span><span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">yf</span><span class="p">,</span><span class="n">mf</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			<span class="n">mf</span><span class="p">,</span><span class="n">yf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mf</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">yf</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">cdate_override</span><span class="p">:</span>
			<span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
			<span class="n">yy</span><span class="p">,</span><span class="n">mm</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">yy</span><span class="p">,</span><span class="n">mm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">y0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
				<span class="k">if</span> <span class="p">(((</span><span class="n">yy</span><span class="o">==</span><span class="n">y0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">mm</span><span class="o">&gt;</span><span class="n">m0</span><span class="p">))</span><span class="o">|</span><span class="p">(</span><span class="n">yy</span><span class="o">&gt;</span><span class="n">y0</span><span class="p">)):</span>
					<span class="n">mi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="k">else</span> <span class="n">mm</span> 
				<span class="k">else</span><span class="p">:</span>
					<span class="n">mi</span> <span class="o">=</span> <span class="n">m0</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">yy</span><span class="o">&gt;</span><span class="n">y0</span><span class="p">):</span>
					<span class="n">yi</span> <span class="o">=</span> <span class="n">yy</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="k">else</span> <span class="n">yy</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">yi</span> <span class="o">=</span> <span class="n">y0</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">yi</span><span class="p">,</span><span class="n">mi</span> <span class="o">=</span> <span class="n">yy</span><span class="p">,</span><span class="n">mm</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">yi</span><span class="p">,</span><span class="n">mi</span> <span class="o">=</span> <span class="n">y0</span><span class="p">,</span><span class="n">m0</span>
		<span class="n">mi</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">yi</span> <span class="o">&lt;=</span> <span class="mi">2007</span> <span class="k">else</span> <span class="n">mi</span>
		<span class="n">yi</span> <span class="o">=</span> <span class="mi">2007</span> <span class="k">if</span> <span class="n">yi</span> <span class="o">&lt;</span> <span class="mi">2007</span> <span class="k">else</span> <span class="n">yi</span>

		<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">yf</span> <span class="o">==</span> <span class="n">yi</span><span class="p">:</span>
			<span class="n">dates</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">yi</span><span class="p">),(</span><span class="s1">&#39;00&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mm</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">mf</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">dates</span> <span class="o">+=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">yi</span><span class="p">),(</span><span class="s1">&#39;00&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mm</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="mi">13</span><span class="p">)]</span>
			<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">yi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">yf</span><span class="p">):</span>
				<span class="n">dates</span> <span class="o">+=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">yy</span><span class="p">),(</span><span class="s1">&#39;00&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mm</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)]</span>
			<span class="n">dates</span> <span class="o">+=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">yf</span><span class="p">),(</span><span class="s1">&#39;00&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mm</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">mf</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

		<span class="n">rest_start</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">rest_end</span>   <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">y</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">y</span><span class="o">==</span><span class="s1">&#39;2015&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">7</span><span class="p">))</span><span class="o">|</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2016</span><span class="p">):</span><span class="c1">#Here is the cutoff to go to rest</span>
					<span class="n">rest_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">rest_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">rest_start</span>
					<span class="n">rest_end</span>   <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_pageviews_grok</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="n">daily</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rest_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_pageviews_rest</span><span class="p">(</span><span class="n">rest_start</span><span class="p">,</span><span class="n">rest_end</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="n">daily</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">daily</span><span class="p">:</span>
			<span class="n">dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">m</span> <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">])</span>
			<span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="n">day</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">day</span><span class="p">[:</span><span class="n">find_nth</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="n">day</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">day</span><span class="p">]</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">}</span>
		<span class="k">else</span><span class="p">:</span>	
			<span class="n">_out</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">])</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">m</span><span class="p">:</span><span class="n">_out</span><span class="p">[</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">}</span>
			<span class="c1">#out = {y+&#39;-&#39;+m:self._views[lang][y+&#39;-&#39;+m] for y,m in dates}</span>
		<span class="k">return</span> <span class="n">out</span>

	<span class="k">def</span> <span class="nf">_pageviews_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rest_start</span><span class="p">,</span><span class="n">rest_end</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&amp;</span><span class="n">daily</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="n">sd</span> <span class="o">=</span> <span class="n">rest_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rest_start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;01&#39;</span>
		<span class="k">if</span> <span class="n">rest_end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;12&#39;</span><span class="p">:</span>
			<span class="n">fd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rest_end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;0101&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">fd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rest_end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;00&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rest_end</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;01&#39;</span>

		<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/&#39;</span><span class="o">+</span><span class="n">lang</span><span class="o">+</span><span class="s1">&#39;.wikipedia/all-access/user/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/daily/&#39;</span><span class="o">+</span><span class="n">sd</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">fd</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">_rget</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
		<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
			<span class="n">monthly</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;views&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
			<span class="n">monthly</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">monthly</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
			<span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">monthly</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">daily</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;views&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
			<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">day</span><span class="p">]</span>
	
	<span class="k">def</span> <span class="nf">_pageviews_grok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="n">daily</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">&amp;</span><span class="n">daily</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
		<span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;http://stats.grok.se/json/&#39;</span><span class="o">+</span><span class="n">lang</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">y</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">_rget</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;daily_views&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
		<span class="k">if</span> <span class="n">daily</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;daily_views&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_daily_views</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;daily_views&#39;</span><span class="p">][</span><span class="n">day</span><span class="p">]</span>

<div class="viewcode-block" id="article.find_article"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.article.find_article">[docs]</a>	<span class="k">def</span> <span class="nf">find_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Find the article by trying different combinations of the title&#39;s capitalization.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
			<span class="n">old_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
			<span class="n">titles</span> <span class="o">=</span> <span class="n">correct_titles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
			<span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
					<span class="k">break</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">old_title</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_is_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the phrase after the verb &#39;to be&#39; in the first paragraph of the extract.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		full : boolean (False)</span>
<span class="sd">			If True it will return a tuple with (phrase,sentence,verb), otherwise it returns only phrase.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		phrase : str</span>
<span class="sd">			Phrase after the verb &#39;to be&#39;.</span>
<span class="sd">		sentence : str</span>
<span class="sd">			Full sentence that contains the verb &#39;to be&#39;.</span>
<span class="sd">		verb : str</span>
<span class="sd">			Verb to be as it appears in the sentence.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isa_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">sent_detector</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;tokenizers/punkt/english.pickle&#39;</span><span class="p">)</span>
			<span class="n">lmt</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
			<span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
			<span class="n">sentences</span> <span class="o">=</span> <span class="n">sent_detector</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
			<span class="n">found_tobe</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="n">phrase</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
			<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
				<span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">))</span>
				<span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">tag</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VB&#39;</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">lmt</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;be&#39;</span><span class="p">:</span>
							<span class="n">found_tobe</span> <span class="o">=</span> <span class="kc">True</span>
							<span class="n">phrase</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">sentence</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
							<span class="k">break</span>
				<span class="k">if</span> <span class="n">found_tobe</span><span class="p">:</span>
					<span class="k">break</span>
			<span class="k">if</span> <span class="n">found_tobe</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_isa_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">phrase</span><span class="p">,</span><span class="n">sentence</span><span class="p">,</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_isa_values</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">full</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isa_values</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isa_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="place"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.place">[docs]</a><span class="k">class</span> <span class="nc">place</span><span class="p">(</span><span class="n">article</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Places (includes methods to get coordinates).&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">place</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_is_city</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_wpcities</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="place.coords"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.place.coords">[docs]</a>	<span class="k">def</span> <span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wiki</span><span class="o">=</span><span class="s1">&#39;wp&#39;</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get the coordinates either from Wikipedia or Wikidata.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		wiki : string</span>
<span class="sd">			Wiki to use, either &#39;wd&#39; or &#39;wp&#39;.</span>
<span class="sd">			Default is &#39;wp&#39;</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">wiki</span><span class="o">==</span><span class="s1">&#39;wd&#39;</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P625&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">wiki</span> <span class="o">=</span><span class="s1">&#39;en&#39;</span> <span class="k">if</span> <span class="n">wiki</span> <span class="o">==</span> <span class="s1">&#39;wp&#39;</span> <span class="k">else</span> <span class="n">wiki</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">wiki</span> <span class="o">!=</span><span class="s1">&#39;en&#39;</span><span class="p">:</span>
						<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span><span class="s2">&quot;titles&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">langlinks</span><span class="p">(</span><span class="n">wiki</span><span class="p">)},</span><span class="n">lang</span><span class="o">=</span><span class="n">wiki</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span><span class="s2">&quot;pageids&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()})</span>
					<span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">wikicode</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">())</span>
					<span class="n">templates</span> <span class="o">=</span> <span class="n">wikicode</span><span class="o">.</span><span class="n">filter_templates</span><span class="p">()</span>
					<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
					<span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">])</span>
					<span class="k">if</span> <span class="s1">&#39;coord&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
							<span class="n">name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
							<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;coord&#39;</span><span class="p">:</span>
								<span class="n">lat</span> <span class="o">=</span> <span class="p">[]</span>
								<span class="n">lon</span> <span class="o">=</span> <span class="p">[]</span>
								<span class="n">values</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">params</span>
								<span class="n">dms</span> <span class="o">=</span> <span class="kc">False</span>
								<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
									<span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;format&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;dms&#39;</span><span class="p">):</span>
										<span class="n">dms</span> <span class="o">=</span> <span class="kc">True</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">dms</span><span class="p">:</span>
									<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
										<span class="n">lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">):</span>
											<span class="k">break</span>
									<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
										<span class="n">lon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">):</span>
											<span class="k">break</span>
									<span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span> <span class="p">(</span><span class="n">_dms2dd</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span><span class="n">_dms2dd</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
								<span class="k">break</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latd&#39;</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;latns&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;longd&#39;</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;longew&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
						<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
							<span class="n">name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
							<span class="k">if</span> <span class="s1">&#39;infobox settlement&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
								<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
									<span class="n">name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
									<span class="k">for</span> <span class="n">ppp</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
										<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">ppp</span><span class="p">:</span>
											<span class="n">parameters</span><span class="p">[</span><span class="n">ppp</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
								<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;latd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;latd&#39;</span><span class="p">])</span>
								<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;longd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;longd&#39;</span><span class="p">])</span>
								<span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;latns&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
									<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;latd&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
								<span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;latew&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
									<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;longd&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
								<span class="k">break</span>
						<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;latd&#39;</span><span class="p">],</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;longd&#39;</span><span class="p">])</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span></div>

<div class="viewcode-block" id="place.country"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.place.country">[docs]</a>	<span class="k">def</span> <span class="nf">country</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">GAPI_KEY</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Uses google places API to get the country of the given place.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		GAPI_KEY : str</span>
<span class="sd">			Name of the environment variable that has the API key.</span>
<span class="sd">		name : boolean (False)</span>
<span class="sd">			If True it returns the name of the country.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		ccode : str</span>
<span class="sd">			Country code.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ctr</span><span class="p">,</span><span class="n">ccode</span> <span class="o">=</span> <span class="n">country</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">(),</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">GAPI_KEY</span><span class="o">=</span><span class="n">GAPI_KEY</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctr</span><span class="p">,</span><span class="n">ccode</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">name</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="song"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.song">[docs]</a><span class="k">class</span> <span class="nc">song</span><span class="p">(</span><span class="n">article</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Class for songs.&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">song</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_wpsong</span>  <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_genre</span>   <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="song.disambiguate"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.song.disambiguate">[docs]</a>	<span class="k">def</span> <span class="nf">disambiguate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">artist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		If the provided page is a disambiguation page, it returns the song that it was able to find within the links.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		artist : str (optional)</span>
<span class="sd">			If provided it will get the song associated with the given artist.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">song_titles</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="s2">&quot;(disambiguation)&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; (disambiguation)&#39;</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
		<span class="k">if</span> <span class="p">(</span><span class="s2">&quot;(disambiguation)&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;NA&#39;</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">get_links</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">()):</span>
				<span class="k">if</span> <span class="n">song</span><span class="p">(</span><span class="n">link</span><span class="p">)</span><span class="o">.</span><span class="n">is_song</span><span class="p">():</span>
					<span class="n">song_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">song_titles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">[]</span>
			<span class="k">if</span> <span class="n">artist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">song_titles</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">a</span> <span class="o">=</span> <span class="n">article</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
				<span class="n">a</span><span class="o">.</span><span class="n">find_article</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">sep</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;and&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;&#39;</span><span class="p">]:</span>
						<span class="k">if</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">artist</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
							<span class="n">a</span> <span class="o">=</span> <span class="n">article</span><span class="p">(</span><span class="n">artist</span><span class="p">[:</span><span class="n">artist</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">sep</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
							<span class="n">a</span><span class="o">.</span><span class="n">find_article</span><span class="p">()</span>
							<span class="k">break</span>
				<span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">song_titles</span><span class="p">:</span>
						<span class="n">perf</span> <span class="o">=</span> <span class="n">song</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">performer</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">perf</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">title</span><span class="p">():</span>
							<span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
				<span class="k">return</span> <span class="p">[]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="song.find_article"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.song.find_article">[docs]</a>	<span class="k">def</span> <span class="nf">find_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Find the article by trying different combinations of the title.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
			<span class="n">old_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
			<span class="n">titles</span> <span class="o">=</span> <span class="n">correct_titles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
			<span class="n">titles</span> <span class="o">+=</span> <span class="p">[</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39; (song)&#39;</span> <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">]</span>
			<span class="n">disamb</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
				<span class="n">disamb</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;(disambiguation)&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()))</span>
				<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_song</span><span class="p">()):</span>
					<span class="k">break</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">old_title</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disamb</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">d</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">Itype</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span></div>

<div class="viewcode-block" id="song.is_song"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.song.is_song">[docs]</a>	<span class="k">def</span> <span class="nf">is_song</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span><span class="o">=</span><span class="kc">False</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wpsong_template</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;song&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_a</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">|</span><span class="p">(</span><span class="s1">&#39;single&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_a</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span></div>

	<span class="k">def</span> <span class="nf">_wpsong_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the template associated to the WP Songs when available.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wpsong</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s2">&quot;revisions&quot;</span><span class="p">,</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;rvsection&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="s1">&#39;Talk:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()})</span>
			<span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="s1">&#39;revisions&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="n">wikicode</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
				<span class="n">templates</span> <span class="o">=</span> <span class="n">wikicode</span><span class="o">.</span><span class="n">filter_templates</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
					<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;songs&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_wpsong</span> <span class="o">=</span> <span class="n">t</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_is_song</span> <span class="o">=</span> <span class="kc">True</span>
						<span class="k">break</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wpsong</span>

<div class="viewcode-block" id="song.performer"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.song.performer">[docs]</a>	<span class="k">def</span> <span class="nf">performer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">article</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P175&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">title</span><span class="p">()</span></div></div>




<div class="viewcode-block" id="biography"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography">[docs]</a><span class="k">class</span> <span class="nc">biography</span><span class="p">(</span><span class="n">article</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Class for biographies of real people.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">biography</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_wpbio</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_death_date</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_birth_date</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="c1">#if not self.is_bio():</span>
		<span class="c1">#	print &#39;Warning: Not a biography (&#39;+str(self.curid())+&#39;)&#39;</span>

	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">()</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">wdid</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;curid : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curid</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;title : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;curid : None</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;name  : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">!=</span><span class="s1">&#39;NULL&#39;</span> <span class="k">else</span> <span class="s1">&#39;name  : None</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wd</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;wdid  : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">wdid</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;wdid  : None</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">out</span><span class="o">+=</span> <span class="s1">&#39;L     : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">())</span> 
		<span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="biography.name"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography.name">[docs]</a>	<span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;\([^\(\)]*\)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_wd</span><span class="p">()</span>
				<span class="k">if</span> <span class="s1">&#39;aliases&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="k">if</span> <span class="s1">&#39;en&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;aliases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;aliases&#39;</span><span class="p">][</span><span class="s1">&#39;en&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;aliases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;aliases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

<div class="viewcode-block" id="biography.desc"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography.desc">[docs]</a>	<span class="k">def</span> <span class="nf">desc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		One sentence description of the person.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">phrase</span><span class="p">,</span><span class="n">sentence</span><span class="p">,</span><span class="n">verb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_a</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">parse_p</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
			<span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="n">sentence</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39; +&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">sentence</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sentence</span></div>

<div class="viewcode-block" id="biography.is_bio"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography.is_bio">[docs]</a>	<span class="k">def</span> <span class="nf">is_bio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Classifier for biographies</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		is_bio : boolean</span>
<span class="sd">			True if page is a biography.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
			<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_wp</span><span class="p">):</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wpbio_template</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_group</span><span class="p">():</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">False</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span></div>

	<span class="k">def</span> <span class="nf">_is_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">phrase</span><span class="p">,</span><span class="n">sentence</span><span class="p">,</span><span class="n">verb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_a</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">verb</span><span class="o">==</span><span class="s1">&#39;are&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">verb</span><span class="o">==</span><span class="s1">&#39;were&#39;</span><span class="p">):</span>
			<span class="k">return</span> <span class="kc">True</span>
		<span class="n">words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">phrase</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
		<span class="n">buzz_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">,</span><span class="s1">&#39;duo&#39;</span><span class="p">,</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">buzz_words</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">):</span>
				<span class="k">return</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="kc">False</span>

	<span class="k">def</span> <span class="nf">_wpbio_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the template associated to the WP Biography when available.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wpbio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">wp_q</span><span class="p">({</span><span class="s1">&#39;prop&#39;</span><span class="p">:</span><span class="s2">&quot;revisions&quot;</span><span class="p">,</span><span class="s1">&#39;rvprop&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;rvsection&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;titles&#39;</span><span class="p">:</span><span class="s1">&#39;Talk:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()})</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">wikicode</span> <span class="o">=</span> <span class="n">mwparserfromhell</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
				<span class="n">templates</span> <span class="o">=</span> <span class="n">wikicode</span><span class="o">.</span><span class="n">filter_templates</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
					<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;biography&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">|</span><span class="p">(</span><span class="s1">&#39;bio&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_wpbio</span> <span class="o">=</span> <span class="n">t</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_is_bio</span> <span class="o">=</span> <span class="kc">True</span>
						<span class="k">break</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wpbio</span>

<div class="viewcode-block" id="biography.alive"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography.alive">[docs]</a>	<span class="k">def</span> <span class="nf">alive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">boolean</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Retrieves the information whether the biography is about a living or dead person.</span>
<span class="sd">		It uses the WikiProject Biography template from the Talk page to get this information.</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		alive : str</span>
<span class="sd">			Returns either &#39;yes&#39; or &#39;no&#39;.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wpbio_template</span><span class="p">()</span>
		<span class="n">alive</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;living&#39;</span><span class="p">:</span>
					<span class="n">living</span> <span class="o">=</span> <span class="n">drop_comments</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">living</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">):</span>
						<span class="n">alive</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
						<span class="k">break</span>
					<span class="k">elif</span> <span class="p">(</span><span class="n">living</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">):</span>
						<span class="n">alive</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
						<span class="k">break</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">alive</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span>
						<span class="k">break</span>
			<span class="k">if</span> <span class="n">alive</span> <span class="o">==</span> <span class="s1">&#39;NULL&#39;</span><span class="p">:</span>
				<span class="n">phrase</span><span class="p">,</span><span class="n">sentence</span><span class="p">,</span><span class="n">verb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_a</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">verb</span> <span class="o">==</span> <span class="s1">&#39;is&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">verb</span> <span class="o">==</span> <span class="s1">&#39;are&#39;</span><span class="p">):</span>
					<span class="n">alive</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
				<span class="k">elif</span> <span class="p">(</span><span class="n">verb</span> <span class="o">==</span> <span class="s1">&#39;was&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">verb</span> <span class="o">==</span> <span class="s1">&#39;were&#39;</span><span class="p">):</span>
					<span class="n">alive</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
		<span class="k">if</span> <span class="n">boolean</span><span class="p">:</span>
			<span class="n">mp</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">,{</span><span class="s1">&#39;yes&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
			<span class="k">return</span> <span class="n">mp</span><span class="p">[</span><span class="n">alive</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">alive</span></div>


<div class="viewcode-block" id="biography.death_date"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography.death_date">[docs]</a>	<span class="k">def</span> <span class="nf">death_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the death date from the infobox. </span>
<span class="sd">		If it is not available in the infobox (or it cannot parse it) it uses Wikidata.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		raw : boolean (False)</span>
<span class="sd">			If True it also returns the raw text from the infobox.</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		d : tuple</span>
<span class="sd">			(yyyy,mm,dd)</span>
<span class="sd">		t : string (if raw)</span>
<span class="sd">			Raw text from the infobox.</span>

<span class="sd">		MISSING TAG: d-da (490286)</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_death_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;yes&#39;</span><span class="p">:</span>
				<span class="k">return</span> <span class="s1">&#39;alive&#39;</span>
			<span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">]</span>
			<span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">())</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
					<span class="k">if</span> <span class="s1">&#39;death_date&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
						<span class="n">t</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s1">&#39;death_date&#39;</span><span class="p">]</span>
						<span class="k">break</span>
				<span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
					<span class="n">d</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;wd&#39;</span>
				<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P570&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
					<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
				<span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;wd&#39;</span> <span class="k">if</span> <span class="n">t</span> <span class="o">==</span><span class="s1">&#39;NA&#39;</span> <span class="k">else</span> <span class="n">t</span>
				<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P570&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
					<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_death_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
		<span class="n">d</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_death_date</span>
		<span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="biography.occupation"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.biography.occupation">[docs]</a>	<span class="k">def</span> <span class="nf">occupation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">return_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Uses the occupation classifier Occ to predict the occupation.</span>
<span class="sd">		This function will run slow when C is not passed, since it will need to load the classifier in each call.</span>
<span class="sd">		Instead use:</span>

<span class="sd">		&gt;&gt;&gt; C = johnny5.Occ()</span>
<span class="sd">		&gt;&gt;&gt; article.occupation(C=C)</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		C : johnny5.Occ (optional)</span>
<span class="sd">			Occupation classifier included in johnny5. If not provided, this function will be slow.</span>
<span class="sd">		return_all : Boolean (False)</span>
<span class="sd">			If True it will return the probabilities for all occupations in as list of 2-tuples.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		label : str</span>
<span class="sd">			Most likely occupation</span>
<span class="sd">		prob_ratio : float</span>
<span class="sd">			Ratio between the most likely occupation, and the second most likely occupation.</span>
<span class="sd">			If the biography belongs to the training set, it will return prob_ratio=0.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: This function will run slow because it needs to load the classifier in each call.&#39;</span><span class="p">)</span>
			<span class="n">C</span> <span class="o">=</span> <span class="n">Occ</span><span class="p">()</span> <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">C</span>
			<span class="n">article</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_feats</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">feats</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_occ</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">article</span><span class="p">,</span><span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">prob_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">prob_ratio</span></div></div>

<div class="viewcode-block" id="band"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band">[docs]</a><span class="k">class</span> <span class="nc">band</span><span class="p">(</span><span class="n">article</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Class for music bands.</span>
<span class="sd">	It links to Spotify as well.</span>
<span class="sd">	IT SHOULD ALSO LINK TO GENIUS</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">Itype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_is_band</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_btypes</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_genres</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_inception</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_formation_place</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_spotify_id</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="band.btypes"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band.btypes">[docs]</a>	<span class="k">def</span> <span class="nf">btypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Categories this band is an instance of.&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_btypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">tps</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P31&#39;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">tps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">article</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_btypes</span> <span class="o">=</span> <span class="n">tps</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_btypes</span></div>

<div class="viewcode-block" id="band.genres"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band.genres">[docs]</a>	<span class="k">def</span> <span class="nf">genres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Genres according to Wikidata</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		genres : list</span>
<span class="sd">			List of genre names.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genres</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">genres</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P136&#39;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">genres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">article</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_genres</span> <span class="o">=</span> <span class="n">genres</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genres</span></div>

<div class="viewcode-block" id="band.inception"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band.inception">[docs]</a>	<span class="k">def</span> <span class="nf">inception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Band&#39;s creation year</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		year : int</span>
<span class="sd">			Formation year</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inception</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P571&#39;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
					<span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
					<span class="n">cal</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s1">&#39;calendarmodel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">cal</span> <span class="o">!=</span><span class="s1">&#39;Q1985727&#39;</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Unrecognized calendar type &#39;</span><span class="p">,</span><span class="n">cal</span><span class="p">)</span>
					<span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_inception</span> <span class="o">=</span> <span class="n">parse_ints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">()[</span><span class="s1">&#39;musical artist&#39;</span><span class="p">][</span><span class="s1">&#39;years_active&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_inception</span> <span class="o">=</span> <span class="n">parse_ints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">()[</span><span class="s1">&#39;orchestra&#39;</span><span class="p">][</span><span class="s1">&#39;founded&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_inception</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_inception</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inception</span></div>

<div class="viewcode-block" id="band.formation_place"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band.formation_place">[docs]</a>	<span class="k">def</span> <span class="nf">formation_place</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the formation place for the band.</span>
<span class="sd">		Uses Wikidata and Wikipedia</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		place_name : str</span>
<span class="sd">			Name of the formation place.</span>
<span class="sd">			Typically the title of the Wikipedia page corresponding to the place.</span>
<span class="sd">		country_code : str</span>
<span class="sd">			3-digit code of the country where the band was formed</span>
<span class="sd">		lat,lon : (float,float)</span>
<span class="sd">			Coordinates of the formation place.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formation_place</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">formation</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P740&#39;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">fplace</span> <span class="o">=</span> <span class="n">place</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
					<span class="n">pname</span> <span class="o">=</span> <span class="n">fplace</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
					<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="n">fplace</span><span class="o">.</span><span class="n">coords</span><span class="p">()</span>
					<span class="n">formation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
					<span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">))</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="n">ctr</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P495&#39;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">ctr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">place</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P298&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="n">keep</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formation</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
				<span class="n">keep</span> <span class="o">=</span> <span class="n">keep</span><span class="o">&amp;</span><span class="p">(</span><span class="n">formation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">formation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
				<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">formation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">()[</span><span class="s1">&#39;musical artist&#39;</span><span class="p">][</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infobox</span><span class="p">()[</span><span class="s1">&#39;orchestra&#39;</span><span class="p">][</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span>
					<span class="k">if</span> <span class="s1">&#39;[[&#39;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
						<span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:</span><span class="n">o</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;]]&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="k">if</span> <span class="s1">&#39;|&#39;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
						<span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
					<span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
						<span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
					<span class="n">fplace</span> <span class="o">=</span> <span class="n">place</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
					<span class="n">fplace</span><span class="o">.</span><span class="n">find_article</span><span class="p">()</span>
					<span class="n">pname</span> <span class="o">=</span> <span class="n">fplace</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
					<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="n">fplace</span><span class="o">.</span><span class="n">coords</span><span class="p">()</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">pname</span> <span class="o">=</span><span class="s1">&#39;NULL&#39;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">pname</span> <span class="o">!=</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
					<span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">pname</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctr</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_formation_place</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ctr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_formation_place</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

				
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formation_place</span></div>

<div class="viewcode-block" id="band.spotify_id"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band.spotify_id">[docs]</a>	<span class="k">def</span> <span class="nf">spotify_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Uses Wikidata to get the spotify_id of the band.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		spotify_id : str</span>
<span class="sd">			Spotify ID.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotify_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P1902&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_spotify_id</span> <span class="o">=</span> <span class="n">i</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotify_id</span></div>

<div class="viewcode-block" id="band.spotify_pop"><a class="viewcode-back" href="../../rst/article_sclasses.html#johnny5.band.spotify_pop">[docs]</a>	<span class="k">def</span> <span class="nf">spotify_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Average popularity of the top 10 songs of the band</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		mean(pop),max(pop),len(pop)</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spotify_id</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spotify_id</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;NA&#39;</span><span class="p">):</span>
				<span class="n">lz_uri</span> <span class="o">=</span> <span class="s1">&#39;spotify:artist:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">spotify_id</span><span class="p">()</span>
				<span class="n">spotify</span> <span class="o">=</span> <span class="n">spotipy</span><span class="o">.</span><span class="n">Spotify</span><span class="p">()</span>
				<span class="n">results</span> <span class="o">=</span> <span class="n">spotify</span><span class="o">.</span><span class="n">artist_top_tracks</span><span class="p">(</span><span class="n">lz_uri</span><span class="p">)</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tracks&#39;</span><span class="p">])</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tracks&#39;</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span> <span class="o">!=</span> <span class="s1">&#39;NULL&#39;</span><span class="p">:</span>
			<span class="n">pops</span> <span class="o">=</span> <span class="p">[</span><span class="n">track</span><span class="p">[</span><span class="s1">&#39;popularity&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_songs</span><span class="p">]</span>
			<span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">pops</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">pops</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">pops</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">(</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CTY"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.CTY">[docs]</a><span class="k">class</span> <span class="nc">CTY</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	City classifier.</span>
<span class="sd">	Used to classify coordinates into cities.</span>
<span class="sd">	THIS FUNCTION NEEDS TO BE UPDATED!</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">city_data</span><span class="o">=</span><span class="s1">&#39;geonames&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="o">=</span><span class="n">city_data</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/data/&#39;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading data from:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">city_data</span> <span class="o">==</span> <span class="s1">&#39;geonames&#39;</span><span class="p">:</span>
			<span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;geonameid&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;asciiname&#39;</span><span class="p">,</span><span class="s1">&#39;alternatenames&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="s1">&#39;feature class&#39;</span><span class="p">,</span><span class="s1">&#39;feature code&#39;</span><span class="p">,</span>
				<span class="s1">&#39;country code&#39;</span><span class="p">,</span><span class="s1">&#39;cc2&#39;</span><span class="p">,</span><span class="s1">&#39;admin1 code&#39;</span><span class="p">,</span><span class="s1">&#39;admin2 code&#39;</span><span class="p">,</span><span class="s1">&#39;admin3 code&#39;</span><span class="p">,</span><span class="s1">&#39;admin4 code&#39;</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span>
				<span class="s1">&#39;dem&#39;</span><span class="p">,</span><span class="s1">&#39;timezone&#39;</span><span class="p">,</span><span class="s1">&#39;modification date&#39;</span><span class="p">]</span>
			<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;cities5000.txt&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cities</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">c_coords</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">[[</span><span class="s1">&#39;geonameid&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">city_data</span> <span class="o">==</span> <span class="s1">&#39;chandler&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cities</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;chandler_cities.csv&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">c_coords</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">[[</span><span class="s1">&#39;ch_id&#39;</span><span class="p">,</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_out</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="CTY.city"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.CTY.city">[docs]</a>	<span class="k">def</span> <span class="nf">city</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coords</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Returns the city&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)):</span>
		<span class="c1">#if (len(coords) == 2)&amp;(not hasattr(coords[0], &#39;__iter__&#39;)):</span>
			<span class="k">if</span> <span class="n">coords</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span> <span class="o">=</span> <span class="n">_city</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coords</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">coords_</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span> <span class="k">if</span> <span class="n">coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
			<span class="n">n_jobs</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span>
			<span class="n">distances</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">_city</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords_</span><span class="p">)</span>
			<span class="n">dmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">coords_</span><span class="p">,</span><span class="n">distances</span><span class="p">))</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmap</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
				<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="p">[</span><span class="n">coord</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">out</span></div></div>

<span class="k">def</span> <span class="nf">_city</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">coords</span><span class="p">):</span>
	<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="n">c_coords</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">city</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vincenty</span><span class="p">(</span><span class="n">coords</span><span class="p">,(</span><span class="n">city</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">city</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span><span class="p">))</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">C</span><span class="o">.</span><span class="n">city_data</span> <span class="o">==</span> <span class="s1">&#39;geonames&#39;</span><span class="p">:</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geonameid&#39;</span><span class="p">,</span><span class="s1">&#39;dis&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;dis&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;geonameid&#39;</span><span class="p">]),</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span>
	<span class="k">elif</span> <span class="n">C</span><span class="o">.</span><span class="n">city_data</span> <span class="o">==</span> <span class="s1">&#39;chandler&#39;</span><span class="p">:</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geonameid&#39;</span><span class="p">,</span><span class="s1">&#39;dis&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;dis&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;geonameid&#39;</span><span class="p">]),</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span>
		


<div class="viewcode-block" id="Occ"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.Occ">[docs]</a><span class="k">class</span> <span class="nc">Occ</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Occupation classifier based on Wikipedia and Wikidata information.</span>
<span class="sd">	</span>
<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; C = johnny5.Occ()</span>
<span class="sd">	&gt;&gt;&gt; b = johnny5.biography(&#39;Q937&#39;)</span>
<span class="sd">	&gt;&gt;&gt; C.classify(b)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/data/&#39;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading data from:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
		<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;trained_classifier.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">lmt</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sent_detector</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;tokenizers/punkt/english.pickle&#39;</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">occ_vocab</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;occ_vocab.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tpc_vocab</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;tpc_vocab.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">wdmap</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="nb">dict</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;wd_occs_controlled.tsv&quot;</span><span class="p">)]))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bmap</span>  <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="nb">dict</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;box_controlled.tsv&quot;</span><span class="p">)]))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;train.tsv&quot;</span><span class="p">)])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">train_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<div class="viewcode-block" id="Occ.classify"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.Occ.classify">[docs]</a>	<span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">article</span><span class="p">,</span><span class="n">return_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Classifier function</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		article : johnny5.biography</span>
<span class="sd">			Biography to classify.</span>
<span class="sd">		return_all : boolean (False)</span>
<span class="sd">			If True it will return the probabilities for all occupations in as list of 2-tuples.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		label : str</span>
<span class="sd">			Most likely occupation</span>
<span class="sd">		prob_ratio : float</span>
<span class="sd">			Ratio between the most likely occupation, and the second most likely occupation.</span>
<span class="sd">			If the biography belongs to the training set, it will return prob_ratio=0.</span>
<span class="sd">		&#39;&#39;&#39;</span>	
		<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">curid</span><span class="p">())</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_keys</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">curid</span><span class="p">())],</span><span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">prob_classify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feats</span><span class="p">(</span><span class="n">article</span><span class="p">))</span>
			<span class="n">probs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">c</span><span class="p">,</span><span class="n">probs</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">probs</span><span class="o">.</span><span class="n">samples</span><span class="p">()],</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="n">prob_ratio</span> <span class="o">=</span> <span class="n">probs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">probs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
			<span class="c1">#article._occ = (probs[0][0],prob_ratio)</span>
			<span class="n">article</span><span class="o">.</span><span class="n">_occ</span> <span class="o">=</span> <span class="n">probs</span>
			<span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">probs</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">probs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">prob_ratio</span></div>

	<span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
		<span class="n">text_</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_vocab</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">text_</span><span class="p">:</span>
				<span class="n">text_</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">),</span><span class="n">word</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpc_vocab</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">text_</span><span class="p">:</span>
				<span class="n">text_</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">),</span><span class="n">word</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">text_</span>

	<span class="k">def</span> <span class="nf">_wd_occs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">article</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns the occupations as reported in Wikidata using the vocabulary provided in occ_vocab.txt</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">wd_occs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">wdmap</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">wd_prop</span><span class="p">(</span><span class="s1">&#39;P106&#39;</span><span class="p">)])</span>
		<span class="k">if</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">in</span> <span class="n">wd_occs</span><span class="p">:</span>
			<span class="n">wd_occs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">wd_occs</span>

	<span class="k">def</span> <span class="nf">_isa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">article</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get the first and second occupation reported in the first sentence in Wikipedia, using the controlled vocabulary provided in box_controlled.tsv</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">ex</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
		<span class="n">sentences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sent_detector</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
		<span class="n">first_occ</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">second_occ</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
			<span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">))</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">word</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">tag</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VB&#39;</span><span class="p">:</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmt</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;be&#39;</span><span class="p">:</span>
						<span class="n">first_occ</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
						<span class="n">second_occ</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
						<span class="k">for</span> <span class="n">ww</span> <span class="ow">in</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]]))):</span>
						<span class="c1">#for ww in nltk.word_tokenize(self._normalize(&#39; &#39;.join([w for w,t in words[i+1:]]))):</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">ww</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_vocab</span><span class="p">):</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">second_occ</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">first_occ</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">):</span>
									<span class="n">second_occ</span> <span class="o">=</span> <span class="n">ww</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">first_occ</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">):</span>
									<span class="n">first_occ</span> <span class="o">=</span> <span class="n">ww</span>
						<span class="k">break</span>
			<span class="k">if</span> <span class="n">first_occ</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">first_occ</span><span class="p">,</span><span class="n">second_occ</span>
		<span class="k">return</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span>

	<span class="k">def</span> <span class="nf">_box_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">article</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the type of the first infobox of the provided Wikipedia page using the controlled vocabulary provided in box_controlled.tsv</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bmap</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">infobox</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">types</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s1">&#39;NA&#39;</span>

	<span class="k">def</span> <span class="nf">_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">article</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the topic words from the Wikipedia extract of the provided article, using the vocabulary provided in tpc_controlled.txt</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
		<span class="n">ex</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
		<span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
		<span class="n">ex_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpc_vocab</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ex_words</span><span class="p">:</span>
				<span class="n">words</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">words</span>

<div class="viewcode-block" id="Occ.feats"><a class="viewcode-back" href="../../rst/johnny5.html#johnny5.Occ.feats">[docs]</a>	<span class="k">def</span> <span class="nf">feats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">article</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Gets the features of the article that feed into the classifier.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		article : johnny5.biography</span>
<span class="sd">			Biography to classify.</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		features : collections.defaultdict</span>
<span class="sd">			Dictionary of features.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">article</span><span class="o">.</span><span class="n">_feats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">feats</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">feats</span><span class="p">[</span><span class="s1">&#39;btype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box_type</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
			<span class="n">isa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isa</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
			<span class="n">feats</span><span class="p">[</span><span class="s1">&#39;isa1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">feats</span><span class="p">[</span><span class="s1">&#39;isa2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">tpcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topics</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tpcs</span><span class="p">:</span>
				<span class="n">feats</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">wd_occs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wd_occs</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wd_occs</span><span class="p">:</span>
				<span class="n">feats</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">article</span><span class="o">.</span><span class="n">_feats</span> <span class="o">=</span> <span class="n">feats</span>
		<span class="k">return</span> <span class="n">article</span><span class="o">.</span><span class="n">_feats</span></div></div>

	
<span class="k">def</span> <span class="nf">_id_type</span><span class="p">(</span><span class="n">I</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">_isnum</span><span class="p">(</span><span class="n">I</span><span class="p">):</span>
		<span class="k">return</span> <span class="s1">&#39;curid&#39;</span>
	<span class="k">elif</span> <span class="n">I</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
		<span class="k">return</span> <span class="s1">&#39;curid&#39;</span>
	<span class="k">elif</span> <span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
		<span class="k">return</span> <span class="s1">&#39;wdid&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s1">&#39;title&#39;</span>


<span class="c1">#def read_article(file_name):</span>
<span class="c1">#	&#39;&#39;&#39;</span>
<span class="c1">#	Reads an article from a json file created with article.dump().</span>
<span class="c1">#	&#39;&#39;&#39;</span>
<span class="c1">#	with open(file_name) as data_file:</span>
<span class="c1">#		data_json = json.load(data_file)</span>
<span class="c1">#	for i in [&#39;curid&#39;,&#39;title&#39;,&#39;wdid&#39;]:</span>
<span class="c1">#		if data_json[&#39;I&#39;][i] is not None:</span>
<span class="c1">#			out = article(data_json[&#39;I&#39;][i],Itype=i)</span>
<span class="c1">#			break</span>
<span class="c1">#	out.I = data_json[&#39;I&#39;]</span>
<span class="c1">#	out._data = data_json[&#39;_data&#39;]</span>
<span class="c1">#	out._ex = data_json[&#39;_ex&#39;]</span>
<span class="c1">#	out._langlinks_dat = data_json[&#39;_langlinks_dat&#39;]</span>
<span class="c1">#	out._langlinks = data_json[&#39;_langlinks&#39;]</span>
<span class="c1">#	out._infobox = data_json[&#39;_infobox&#39;]</span>
<span class="c1">#	out.raw_box  = data_json[&#39;raw_box&#39;]</span>
<span class="c1">#	out._image_url = data_json[&#39;_image_url&#39;]</span>
<span class="c1">#	out._wd_claims      = data_json[&#39;_wd_claims&#39;]</span>
<span class="c1">#	out._wd_claims_data = data_json[&#39;_wd_claims_data&#39;]</span>
<span class="c1">#	out._creation_date = data_json[&#39;_creation_date&#39;]</span>
<span class="c1">#	return out</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, C. Jara-Figueroa.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>